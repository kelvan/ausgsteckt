{% extends 'base.html' %}

{% load staticfiles leaflet_tags %}

{% block extracss %}
  {% leaflet_css %}
{% endblock %}

{% block extrajs %}
  {% leaflet_js %}
  <script>
    function onEachFeature(feature, layer) {
      layer.on('click', function (e) {
        console.log(feature.id);
        $.ajax("{% url 'buschenschank_details' '000' %}".replace('000', feature.id), {success: function(data) {
            if ($('#buschenschank_details').is(":visible")) {
              $('#buschenschank_details_content').html(data);
              $('#buschenschank_details').show();
            } else {
              $('#buschenschank_maps').removeClass('col-md-12');
              $('#buschenschank_maps').addClass('col-md-8');
              $('#buschenschank_details').removeClass('col-md-0');
              $('#buschenschank_details').addClass('col-md-4');
              $('#buschenschank_maps').one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",
              function(e){
                $('#buschenschank_details_content').html(data);
                $('#buschenschank_details').show();
                $('#buschenschank_maps').off();
              });
            }
          }
        })
      });
    }
  
    function main_map_init (map, options) {
      var dataurl = "{% url 'buschenschank.geojson' %}";
      // Download GeoJSON via Ajax
      $.getJSON(dataurl, function (data) {
        // Add GeoJSON layer
        L.geoJson(data, {onEachFeature: onEachFeature}).addTo(map);
      });
      map.locate({setView : true, maxZoom: 11});
    }

    function close_details() {
      $('#buschenschank_details_content').html('');
      $('#buschenschank_details').hide();
      $('#buschenschank_maps').removeClass('col-md-8');
      $('#buschenschank_maps').addClass('col-md-12');
    }
  </script>
{% endblock %}

{% block content %}
  <h1>Buschenschankkarte</h1>
  <div class="container-fluid">
    <div class="row">
      <div id="buschenschank_maps" class="col-md-12">
        {% leaflet_map 'ausgstecktmap' callback="main_map_init" %}
      </div>
      <div id="buschenschank_details" class="col-md-0">
        <span class="glyphicon glyphicon-chevron-left sidebar-close" onclick="close_details()" aria-hidden="true">Close</span>
        <div id="buschenschank_details_content"></div>
      </div>
    </div>
  </div>
{% endblock %}
